function initchart(){var e={_proficiency:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],children:null,value:0,key:"",depth:1};chart.refreshChart(e)}function mouseover(e){chart.refreshChart(e);var t=getcrumbpath(e);i(t);d3.selectAll(".skills-sunburst path").style("opacity",.3),sunburst.selectAll("path").filter(function(e){return t.indexOf(e)>=0}).style("opacity",1)}function mouseleave(){d3.selectAll("path").on("mouseover",null);d3.selectAll("path").transition().duration(1e3).style("opacity",1).each("end",function(){d3.select(this).on("mouseover",mouseover)})}function getcrumbpath(e){for(var t=[],n=e;n.parent;)t.unshift(n),n=n.parent;return t}function initbreadcrumb(){d3.select("#skills-chart-breadcrumb").append("svg:svg").attr("width",500).attr("height",50).attr("class","trail")}function h(e,t){var n=[];n.push("0,0");n.push(r.w+",0");n.push(r.w+r.t+","+r.h/2);n.push(r.w+","+r.h);n.push("0,"+r.h);t>0&&n.push(r.t+","+r.h/2);return n.join(" ")}function i(e){e[e.length-1]._color,e.length;var t=d3.select("#skills-chart-breadcrumb .trail").selectAll("g").remove();t=d3.select("#skills-chart-breadcrumb .trail").selectAll("g").data(e,function(e){return e.key+e.depth});var n=t.enter().append("svg:g");n.append("svg:polygon").attr("points",h).style("fill",function(e){return e._color}),n.append("svg:text").attr("x",r.w/2+2).attr("y",r.h/2).attr("dy","0.35em").attr("text-anchor","middle").attr("class","breadcumb-text").style("fill",function(e){return getcolor(d3.rgb(e._color))<150?"#fff":"#000"}).text(function(e){return e.key}),t.attr("transform",function(e,t){return"translate("+t*(r.w+r.s)+", 0)"}),t.exit().remove(),d3.select(".trail").style("visibility","")}function getcolor(e){return.299*e.r+.587*e.g+.114*e.b}function k(e){var t=["#4CC3D9","#FFC65D","#7BC8A4","#93648D","#404040"],n=[-.1,-.05,0];if(1==e.depth){var r=t[coloralternative%5];return coloralternative++,r}if(e.depth>1){var i=n[e.value%3];return d3.rgb(e.parent._color).brighter(.2*e.depth+i*e.depth)}}var l;var chart=function(e){function t(e){var t=[],n=0;return e._proficiency.forEach(function(e){n<=a.length&&(t.push({p:e,date:a[n]}),n++)}),t}function n(t,n){f.domain(e.extent(t,function(e){return e.date}));l.domain([0,100]),d.append("g").attr("class","x-axis axis").attr("transform","translate(0,"+u+")").call(c).append("text").attr("x",450).attr("y",-8).style("text-anchor","end").text("Time"),d.append("g").attr("class","y-axis axis").call(h).append("text").attr("transform","rotate(-90)").attr("y",6).attr("dy",".91em").style("text-anchor","end").text("Proficiency"),d.append("path").datum(t).attr("class","line").attr("id","skills-chart-line").attr("d",p).attr("stroke",function(){return n._color})}function r(r){var i=t(r),s=e.select("#skills-chart-line");null===s[0][0]?n(i,r):s.datum(i).attr("d",p).attr("stroke",function(){return r._color})}var i={},s={top:20,right:20,bottom:30,left:50},o=500-s.left-s.right,u=400-s.top-s.bottom,a=[1999,2e3,2001,2002,2003,2004,2005,2006,2007,2008,2009,2010,2011,2012,2013],f=e.scale.linear().range([0,o]),l=e.scale.linear().range([u,0]),c=e.svg.axis().scale(f).tickValues([1999,2004,2009,2013]).tickFormat(e.format(".0f")).tickPadding(10).tickSize(0).orient("bottom"),h=e.svg.axis().scale(l).tickSize(0).tickPadding(10).tickValues([20,40,60,80,100]).orient("left"),p=e.svg.line().interpolate("basis").x(function(e){return f(e.date)}).y(function(e){return l(e.p)}),d=e.select(".skills-chart").append("svg").attr("width",o+s.left+s.right).attr("height",u+s.top+s.bottom).append("g").attr("transform","translate("+s.left+","+s.top+")");i.refreshChart=r;return i}(d3),width=580,height=580,rad=Math.min(width,height)/Math.PI-25,q=k,r={w:116,h:30,s:3,t:7},sunburst=d3.select(".skills-sunburst").append("svg:svg").attr("width",width).attr("height",height).append("svg:g").attr("transform","translate("+width/2+","+height/2+")");sunburst.append("svg:circle").attr("r",rad).style("opacity",0);var t=function(e,t){var n=[],r=e.length;if(e.length!==t.length)n=e.length>t.length?e:t;else for(var i=0;r>i;i++){var s=Math.max(e[i],t[i])-Math.abs(e[i]-t[i])/8;n.push(s)}return n},u=function(e){if(e instanceof Array)return e;var n=[];return $.each(e,function(e,r){n=t(u(r),n)}),n},proficiencydata=d3.layout.partition().sort(null).size([2*Math.PI,rad]).children(function(e){return e.value instanceof Array?(e._proficiency=e.value,d3.entries([e.value[e.value.length-1]])):(e._proficiency=u(e.value),isNaN(e.value)?d3.entries(e.value):null)}).value(function(e){return e.value}),arc=d3.svg.arc().startAngle(function(e){return e.x}).endAngle(function(e){return e.x+e.dx-.01/(e.depth+.5)}).innerRadius(function(e){return rad/Math.PI*e.depth}).outerRadius(function(e){return rad/Math.PI*(e.depth+1)-1});var coloralternative=0;initbreadcrumb();var path=sunburst.data(d3.entries(skillsdata)).selectAll("g").data(proficiencydata).enter().append("svg:g").attr("display",function(e){return e.depth?null:"none"});path.append("svg:path").attr("d",arc).attr("stroke","#fff").attr("fill",function(e){return e._color=q(e),e._color}).attr("fill-rule","evenodd").attr("display",function(e){return e.children?null:"none"}).on("mouseover",mouseover);path.append("svg:text").attr("transform",function(e){var t=180*((e.x+e.dx/2-Math.PI/2)/Math.PI);return"rotate("+t+")"}).attr("x",function(e){return rad/Math.PI*e.depth}).attr("dx","6").attr("dy",".1em").text(function(e){return e.key}).attr("display",function(e){return e.children?null:"none"}).on("mouseover",mouseover);d3.select(".skills-sunburst").on("mouseleave",mouseleave);l=path.node().__data__.value;sunburst.append("circle").attr("r",rad/Math.PI).attr("opacity",0);initchart()