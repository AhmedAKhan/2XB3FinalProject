function createVisualization(e){function i(e){r.transition().duration(1e3).attrTween("d",arcTweenZoom(e));node=e}node=e;initializeBreadcrumbTrail();drawLegend();d3.select("#togglelegend").on("click",toggleLegend);vis.append("svg:circle").attr("r",radius).style("opacity",0);var t=partition.nodes(e).filter(function(e){return e.dx>.005});var n=e;var r=vis.data([e]).selectAll("path").data(t).enter().append("svg:path").attr("display",function(e){return null}).attr("d",arc).attr("fill-rule","evenodd").style("fill",function(e){return colors[e.name]}).style("opacity",1).style("z-index",1).on("mouseover",mouseover).on("click",i).each(stash);d3.select("#container").on("mouseleave",mouseleave);totalSize=r.node().__data__.value}function stash(e){e.x0=e.x;e.dx0=e.dx}function arcTweenZoom(e){var t=d3.interpolate(x.domain(),[e.x,e.x+e.dx]),n=d3.interpolate(y.domain(),[e.y,radius*radius]),r=d3.interpolate(y.range(),[e.y?20:0,radius]);return function(e,i){return i?function(t){return arc(e)}:function(i){x.domain(t(i));y.domain(n(i)).range(r(i));return arc(e)}}}function mouseover(e){var t=(100*e.value/totalSize).toPrecision(3);var n=t+"%";if(t<.1){n="< 0.1%"}d3.select("#percentage").text(n).style("z-index","10");d3.select("#explanation").style("visibility","visible");var r=getAncestors(e);updateBreadcrumbs(r,n);d3.selectAll("path").style("opacity",.3);vis.selectAll("path").filter(function(e){return r.indexOf(e)>=0}).style("opacity",1)}function mouseleave(e){d3.select("#trail").style("visibility","");d3.selectAll("path").on("mouseover",null);d3.selectAll("path").transition().duration(1e3).style("opacity",1).each("end",function(){d3.select(this).on("mouseover",mouseover)});d3.select("#explanation").style("visibility","hidden")}function getAncestors(e){var t=[];var n=e;while(n.parent){t.unshift(n);n=n.parent}return t}function initializeBreadcrumbTrail(){var e=d3.select("#sequence").append("svg:svg").attr("width",width).attr("height",50).attr("id","trail");e.append("svg:text").attr("id","endlabel").style("fill","#000")}function breadcrumbPoints(e,t){var n=[];n.push("0,0");n.push(b.w+",0");n.push(b.w+b.t+","+b.h/2);n.push(b.w+","+b.h);n.push("0,"+b.h);if(t>0){n.push(b.t+","+b.h/2)}return n.join(" ")}function updateBreadcrumbs(e,t){var n=d3.select("#trail").selectAll("g").data(e,function(e){return e.name+e.depth});var r=n.enter().append("svg:g");r.append("svg:polygon").attr("points",breadcrumbPoints).style("fill",function(e){return colors[e.name]});r.append("svg:text").attr("x",(b.w+b.t)/2).attr("y",b.h/2).attr("dy","0.35em").attr("text-anchor","middle").text(function(e){return e.name});n.attr("transform",function(e,t){return"translate("+t*(b.w+b.s)+", 0)"});n.exit().remove();d3.select("#trail").select("#endlabel").attr("x",(e.length+.5)*(b.w+b.s)).attr("y",b.h/2).attr("dy","0.35em").attr("text-anchor","middle").text(t);d3.select("#trail").style("visibility","")}function drawLegend(){var e={w:75,h:30,s:3,r:3};var t=d3.select("#legend").append("svg:svg").attr("width",e.w).attr("height",d3.keys(colors).length*(e.h+e.s));var n=t.selectAll("g").data(d3.entries(colors)).enter().append("svg:g").attr("transform",function(t,n){return"translate(0,"+n*(e.h+e.s)+")"});n.append("svg:rect").attr("rx",e.r).attr("ry",e.r).attr("width",e.w).attr("height",e.h).style("fill",function(e){return e.value});n.append("svg:text").attr("x",e.w/2).attr("y",e.h/2).attr("dy","0.35em").attr("text-anchor","middle").text(function(e){return e.key})}function toggleLegend(){var e=d3.select("#legend");if(e.style("visibility")=="hidden"){e.style("visibility","")}else{e.style("visibility","hidden")}}function getRandomColor(){var e="0123456789ABCDEF".split("");var t="#";for(var n=0;n<6;n++){t+=e[Math.floor(Math.random()*16)]}return t}function buildHierarchy2(e){var t=e.data;var n={name:"root",children:[]};for(var r=0;r<t.length;r++){n.children.push({name:t[r].name,size:t[r].value});colors[t[r].name]=getRandomColor()}n.x=0;n.dx=Math.PI*2;n.y=0;n.dy=10;n.x0=0;n.color="#ffffff";return n}var width=750;var height=600;var radius=Math.min(width,height)/2;var x=d3.scale.linear().domain([0,2*Math.PI]).range([0,2*Math.PI]);var y=d3.scale.sqrt().domain([0,radius*radius]).range([0,radius]);var b={w:75,h:30,s:3,t:10};var colors={root:"#ffffff"};var totalSize=0;var vis=d3.select("#chart").append("svg:svg").attr("width",width).attr("height",height).append("svg:g").attr("id","container").attr("transform","translate("+width/2+","+height/2+")");var partition=d3.layout.partition().size([2*Math.PI,radius*radius]).value(function(e){return e.size});var arc=d3.svg.arc().startAngle(function(e){return Math.max(0,Math.min(2*Math.PI,x(e.x)))}).endAngle(function(e){return Math.max(0,Math.min(2*Math.PI,x(e.x+e.dx)))}).innerRadius(function(e){return Math.max(0,y(e.y))}).outerRadius(function(e){return Math.max(0,y(e.y+e.dy))});var node;var json=buildHierarchy2(data);createVisualization(json);